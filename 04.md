# 4. 商品詳細ページを作ろう

いまは商品をクリックしても何も起きません。商品をクリックしたら商品詳細ページに遷移してみましょう。

## やること

`src/app/items/[id]/page.tsx` を作ります。

```diff
+import items from "../../../data/items.json";
+
+type Props = {
+  params: {
+    id: string;
+  };
+};
+
+export default async function ItemDetail(props: Props) {
+  const item = items.find((item) => item.id === parseInt(props.params.id));
+
+  if (!item) {
+    return (
+      <main>
+        <h1>商品が見つかりませんでした</h1>
+      </main>
+    );
+  }
+
+  return (
+    <main>
+      <a href="/">← 商品一覧に戻る</a>
+      <img src={item.image} alt={item.name} width={300} />
+      <h1>{item.name}</h1>
+      <p>{item.description}</p>
+      <p>{item.price.toLocaleString()}円</p>
+      <p>カテゴリー: {item.category}</p>
+    </main>
+  );
+}
```

## 解説

### 動的ルーティング

序盤で解説したように、Next.jsでは src/appの下にディレクトリ（＝フォルダ）を作り、そこにpage.tsxという名前のファイルを置くとページができます。`[]`で囲われた部分は任意の値にできるので、`src/app/items/[id]/page.tsx` だと `/items/1`のようなURLになります。今回はidという文字を[]で囲ったので、これを商品のIDとして使いましょう。


### Propsとparams

`props`は`properties`の略で、Reactのコンポーネントに渡すデータのことです。ここでは`params`という特別なキーを使っています。`params`は`parameters`の略で、ここから動的ルーティングで渡された`[id]`の値を取り出すことができます。

※ 最新のNext.jsでは、`params`の型は`Promise<{ id: string }>`に変更されました。現在のバージョンでは `{ id: string }` でも動作しますが、将来は動作しない可能性があります。

### Propsの型注釈

```ts
type Props = {
  params: {
    id: string;
  };
};
```

というコードは型注釈というものです。これによって、`props`の型を指定することができます。型を指定することで、存在しないキーにアクセスした時にエラーを出してくれるようになります。実際にVSCodeで下記のように存在しないキーにアクセスしてみましょう。

![image](./images/type-error.png)

### findメソッド

`find`メソッドは配列の中から特定の条件を満たす要素を探してくれるメソッドです。

```ts
const item = items.items.find(
  (item) => item.id === parseInt(props.params.id)
);
```

という実装では、`items.items` という配列の中から `id` が `props.params.id` と一致する要素を探してくれます。これによって、商品の詳細ページに遷移した時に、その商品のデータを取得することができます。

### 存在しない商品の処理

存在しない商品にアクセスした場合「ありませんでした」と返したいですね。これは途中で `return` して実現しています。JavaScriptでは `return` した時点で関数が終了するので、その後の処理は実行されません。


## やること

最後に、商品一覧ページで商品をクリックしたら商品詳細ページに遷移するようにします。これで商品一覧と商品詳細を行き来することができるようになりました。

```diff
 import items from "../data/items.json";

 const ITEMS_PER_PAGE = 5;

 export default function Home() {
 export default async function Home({ searchParams }) {
   const params = await searchParams;
   const page = params.page;

   const allItems = items;

   const currentPage = page ? parseInt(page) : 1;

   const indexOfLastItem = currentPage * ITEMS_PER_PAGE;
   const indexOfFirstItem = indexOfLastItem - ITEMS_PER_PAGE;
   const currentItems = allItems.slice(indexOfFirstItem, indexOfLastItem);

   return (
     <main className="container mx-auto px-4 py-8">
       <h1 className="text-3xl font-bold mb-8">商品一覧</h1>
       <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
         {allItems.map((item) => (
         {currentItems.map((item) => (
           <div key={item.id} className="border rounded-lg overflow-hidden shadow-lg">
+          <a href={`/items/${item.id}`}>
           <div className="p-4">
             <img
               src={item.image}
               alt={item.name}
               className="w-full h-48 object-cover"
             />
             <h2 className="text-xl font-semibold mb-2">{item.name}</h2>
             <p className="text-gray-600 mb-2">{item.description}</p>
             <p className="text-xl font-bold text-blue-600">{item.price}円</p>
           </div>
+          </a>
           </div>
         ))}
       </div>
```
