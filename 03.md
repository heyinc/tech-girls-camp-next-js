# 3. ページ送りを実装してみよう

いまのところ、全ての商品を一つのページに表示しています。これをページにわけて（ページ送りで）表示してみましょう。

## やること1: ページ送りのボタンを作る

まずは素朴にページ送りします。下記のように `src/app/page.tsx` を変更してください。

```diff
 import items from "../data/items.json";

+const ITEMS_PER_PAGE = 5;
+
-export default function Home() {
-  const allItems = items;
+export default async function Home({ searchParams }) {
+  const params = await searchParams;
+  const page = params.page;
+
+  const allItems = items;
+
+  const currentPage = page ? parseInt(page) : 1;
+
+  const indexOfLastItem = currentPage * ITEMS_PER_PAGE;
+  const indexOfFirstItem = indexOfLastItem - ITEMS_PER_PAGE;
+  const currentItems = allItems.slice(indexOfFirstItem, indexOfLastItem);
+
   return (
     <main className="container mx-auto px-4 py-8">
       <h1 className="text-3xl font-bold mb-8">商品一覧</h1>
       <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
-        {allItems.map((item) => (
+        {currentItems.map((item) => (
           <div key={item.id} className="border rounded-lg overflow-hidden shadow-lg">
           <div className="p-4">
             <img
               src={item.image}
               alt={item.name}
               className="w-full h-48 object-cover"
             />
             <h2 className="text-xl font-semibold mb-2">{item.name}</h2>
             <p className="text-gray-600 mb-2">{item.description}</p>
             <p className="text-xl font-bold text-blue-600">{item.price}円</p>
           </div>
           </div>
         ))}
       </div>
+
+      <div>
+        <a href={`?page=${currentPage - 1}`}>前へ</a>
+        <a href={`?page=${currentPage + 1}`}>次へ</a>
+      </div>
     </main>
   );
 }
```

### 解説

#### searchParamsの取得

`await searchParams`でクエリパラメータが取得できます。これはNext.jsのApp Routerの機能です。

ドキュメント: https://nextjs.org/docs/app/api-reference/file-conventions/page#searchparams-optional

#### 三項演算子

`const currentPage = page ? parseInt(page) : 1` は三項演算子と呼ばれる構文です。条件によって表示する内容を切り替えることができます。この場合、pageがあった場合はその値を数値に変換したもの、pageがなかった場合は1を`currentPage`に代入しています。

#### 文字列から数値への変換

`parseInt`を使うと文字列を数値に変換できます。URLのクエリパラメータは文字列として渡されるため、数値計算をする前に変換が必要です。
ドキュメント: https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/parseInt

#### 四則演算

`+` `-` `*` `/` は四則演算です。これらは数値を計算するための演算子です。ここでは

```ts
const indexOfLastItem = currentPage * ITEMS_PER_PAGE;
```

は現在のページと商品の表示数を掛け合わせて、表示する最後の商品のインデックスを計算しています。

```ts
const indexOfFirstItem = indexOfLastItem - ITEMS_PER_PAGE;
```

は最後の商品のインデックスから商品の表示数を引いて、表示する最初の商品のインデックスを計算しています。

#### 配列の一部を取り出す

`slice`メソッドを使うと配列から指定した範囲の要素を取り出せます。ここでは現在のページに表示すべき商品だけを取り出しています。
図で説明するとこんな感じです。
![slice](./images/array-slice.png)
ドキュメント: https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/slice

#### リンク

`a`タグを使うと他のページへのリンクを作れます。リンク先は`href`属性で指定します。


## やること2: 最初のページと最後のページの表示を改善する

最初のページでは前へ、最後のページでは次へのリンクを表示しないようにしたいですね。下記のように `src/app/page.tsx` を変更してください。

```diff
   const indexOfLastItem = currentPage * ITEMS_PER_PAGE;
   const indexOfFirstItem = indexOfLastItem - ITEMS_PER_PAGE;
   const currentItems = allItems.slice(indexOfFirstItem, indexOfLastItem);
+  const isFirstPage = currentPage === 1;
+  const isLastPage = currentPage * ITEMS_PER_PAGE >= allItems.length;

   return (
     <main className="container mx-auto px-4 py-8">
@@ -38,19 +40,17 @@ export default async function Home({ searchParams }) {
       </div>

       <div className="flex justify-center items-center mt-8 gap-4">
-        <a href={`?page=${currentPage - 1}`}>前へ</a>
+        {isFirstPage ? (<span>前へ</span>) : ( <a href={`?page=${currentPage - 1}`}>前へ</a> )}

-        <a href={`?page=${currentPage + 1}`} >次へ</a>
+        {isLastPage ? (<span>次へ</span>) : (<a href={`?page=${currentPage + 1}`}>次へ</a>)}
       </div>
     </main>
   );
 }
```

### 解説

#### 条件の確認

`isFirstPage` は現在のページが最初のページかどうかを確認しています。

現在のページと商品の表示数を掛け合わせた値が全ての商品の数よりも大きい場合は、最後のページにいるということですね。この結果を `isLastPage` に代入しています。

#### 表示の切り替え

`{ isFirstPage ? (省略) : (省略) }` のように、三項演算子を使うことで、条件によって表示する内容を切り替えています。

#### spanタグ

`<span>` は（リンクではない）テキストを表示するためのタグです。これを使うことで、リンクではなくテキストを表示することができます。
