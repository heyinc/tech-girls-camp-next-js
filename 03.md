# 3. 商品をページ送りしよう

いまのところ、全ての商品を一つのページに表示しています。これをページにわけて（ページ送りで）表示してみましょう。

## やること1: ページ送りのボタンを作る

まずは素朴にページ送りします。下記のように `src/app/page.tsx` を変更してください。

```diff
+import Link from "next/link";
 import items from "../data/items.json";
 
-export default function Home() {
+const ITEMS_PER_PAGE = 5;
+
+export default async function Home({ searchParams }) {
+  const { page } = await searchParams;
+
   const allItems = items.items;
+
+  const currentPage = page ? parseInt(page) : 1;
+
+  const indexOfLastItem = currentPage * ITEMS_PER_PAGE;
+  const indexOfFirstItem = indexOfLastItem - ITEMS_PER_PAGE;
+  const currentItems = allItems.slice(indexOfFirstItem, indexOfLastItem);
+
   return (
     <main className="container mx-auto px-4 py-8">
       <h1 className="text-3xl font-bold mb-8">商品一覧</h1>
       <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
-        {allItems.map((item) => (
+        {currentItems.map((item) => (
           <div
             key={item.id}
             className="border rounded-lg overflow-hidden shadow-lg"
@@ -24,6 +36,22 @@ export default function Home() {
           </div>
         ))}
       </div>
+
+      <div className="flex justify-center items-center mt-8 gap-4">
+        <Link
+          href={`?page=${currentPage - 1}`}
+          className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
+        >
+          前へ
+        </Link>
+
+        <Link
+          href={`?page=${currentPage + 1}`}
+          className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
+        >
+          次へ
+        </Link>
+      </div>
     </main>
   );
 }
```

### 解説

#### searchParamsの取得
`await searchParams`でクエリパラメータが取得できます。これはNext.jsのApp Routerの機能です。
ドキュメント: https://nextjs.org/docs/app/api-reference/file-conventions/page#searchparams-optional

#### 文字列から数値への変換
`parseInt`を使うと文字列を数値に変換できます。URLのクエリパラメータは文字列として渡されるため、数値計算をする前に変換が必要です。
ドキュメント: https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/parseInt

#### 配列の一部を取り出す
`slice`メソッドを使うと配列から指定した範囲の要素を取り出せます。ここでは現在のページに表示すべき商品だけを取り出しています。
ドキュメント: https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/slice

#### 分割代入
`const { page } = await searchParams`はオブジェクトの分割代入という構文です。オブジェクトのプロパティを簡潔に変数に代入できます。分割代入を使わない場合は以下のように書きます：

```js
const params = await searchParams;
const page = params.page
```

#### Linkコンポーネント
`Link`はNext.jsが提供するコンポーネントです。通常のHTMLの`a`タグと似ていますが、Next.js内での最適化が行われるため、アプリケーション内の遷移に使用します。
ドキュメント: https://nextjs.org/docs/pages/api-reference/components/link


## やること2: 最初のページと最後のページのボタンの表示を改善する

最初のページ、最後のページはボタンを表示しないようにしたいですね。下記のように `src/app/page.tsx` を変更してください。

```diff
   const indexOfLastItem = currentPage * ITEMS_PER_PAGE;
   const indexOfFirstItem = indexOfLastItem - ITEMS_PER_PAGE;
   const currentItems = allItems.slice(indexOfFirstItem, indexOfLastItem);
+  const isFirstPage = currentPage === 1;
+  const isLastPage = currentPage * ITEMS_PER_PAGE >= allItems.length;
 
   return (
     <main className="container mx-auto px-4 py-8">
@@ -38,19 +40,17 @@ export default async function Home({ searchParams }) {
       </div>
 
       <div className="flex justify-center items-center mt-8 gap-4">
-        <Link
-          href={`?page=${currentPage - 1}`}
-          className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
-        >
-          前へ
-        </Link>
+        {isFirstPage ? (
+          <span className="text-gray-400">前へ</span>
+        ) : (
+          <Link href={`?page=${currentPage - 1}`}>前へ</Link>
+        )}
 
-        <Link
-          href={`?page=${currentPage + 1}`}
-          className="px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600"
-        >
-          次へ
-        </Link>
+        {isLastPage ? (
+          <span className="text-gray-400">次へ</span>
+        ) : (
+          <Link href={`?page=${currentPage + 1}`}>次へ</Link>
+        )}
       </div>
     </main>
   );
```

### 解説

#### 条件分岐の表現
`{ isFirstPage ? foo : bar }` は三項演算子と呼ばれる構文です。条件によって表示する内容を切り替えることができます。この場合、最初のページでは「前へ」ボタンをクリックできない灰色のテキストとして表示し、それ以外のページでは通常のリンクとして表示しています。

同様に、最後のページでは「次へ」ボタンを無効化しています。これにより、ユーザーは存在しないページに移動しようとすることがなくなります。

`className="text-gray-400"` は文字を灰色にするTailwind CSSのクラスです。スタイルについては後のステップで詳しく学びます。